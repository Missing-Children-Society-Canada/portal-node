<% include ../../views/partials/header %>

  <div class="container profile">
    <div class="jumbotron">
      <div class="row">
        <div class="col-md-4">
          <h2 id=profileId hidden="true">
            <%= profile.id %>
          </h2>
          <img src="<%= profile.photo %>" class="img-responsive">
        </div>
        <div class="col-md-8" style="background-color: #fff">
          <% if (profile.name) { %>
            <h3><i class="fa fa-user" aria-hidden="true"></i>
              <%= profile.name %>
            </h3>
            <% } %>
              <table class="table table-hover table-user-information">
                <tbody>

                  <% if (profile.triggeredOn) { %>
                    <tr>
                      <td>Date Triggered:</td>
                      <td>
                        <%= profile.triggeredOn.toLocaleString() %>
                      </td>
                    </tr>
                    <% } %>
                      <% if (profile.birthday) { %>
                        <tr>
                          <td>Date of Birth:</td>
                          <td>
                            <%= profile.birthday.toLocaleDateString() %>
                          </td>
                        </tr>
                        <tr>
                          <td>Age:</td>
                          <td>
                            <%= profile.age %>
                          </td>
                        </tr>
                        <% } %>
                          <% if (profile.gender) { %>
                            <tr>
                              <td>Gender:</td>
                              <td>
                                <%= profile.gender %>
                              </td>
                            </tr>
                            <% } %>
                              <% if (profile.email) { %>
                                <tr>
                                  <td>Email</td>
                                  <td><a href="mailto:<%= profile.email %>"><i class="fa fa-envelope-o" aria-hidden="true"></i> <%= profile.email %></a></td>
                                </tr>
                                <% } %>
                                  <% if (profile.phonenumber) { %>
                                    <tr>
                                      <td>Phone Number</td>
                                      <td>
                                        <%= profile.phonenumber %>
                                      </td>
                                    </tr>
                                    <% } %>
                                      <% if (profile.social) { %>
                                        <tr>
                                          <td>Social</td>
                                          <td>
                                            <ul class="social-list">
                                              <% if (profile.social.twitter.handle) { %>
                                                <li>
                                                  <a href="https://twitter.com/<%= profile.social.twitter.handle %>" target="_new"><i class="fa fa-twitter-square" aria-hidden="true"></i> Twitter</a>
                                                  <% if(profile.mostRecentPlatform === 'twitter') { %> <em><i class="fa fa-info-circle" aria-hidden="true"></i> Most recently used. <% } %>
              </li>
            <% } %>
            <% if (profile.social.instagram.handle) { %>
              <li>
                <a href="https://instagram.com/<%= profile.social.instagram.handle %>" target="_new"><i class="fa fa-instagram" aria-hidden="true"></i> Instagram</a>
                <% if(profile.mostRecentPlatform === 'instagram') { %> <em><i class="fa fa-info-circle" aria-hidden="true"></i> Most recently used. <% } %>
              </li>
            <% } %>
            <% if (profile.social.facebook.profile) { %>
              <li>
                <a href="https://facebook.com/<%= profile.social.facebook.profile %>" target="_new"><i class="fa fa-facebook-square" aria-hidden="true"></i> Facebook</a>
                <% if(profile.mostRecentPlatform === 'facebook') { %> <em><i class="fa fa-info-circle" aria-hidden="true"></i> Most recently used. <% } %>
              </li>
            <% } %>
            <ul>
          </td>
        </tr>
        <% } %>
        <tr>
          <td></td>
          <td>
            <form class="pull-right form-inline">
          <input id="sendEmail" type="email" placeholder="jane.doe@example.com" class="form-control" required="true">
          <button id="sendBtn" class="btn btn-default">Send</button>
          <div id="email-sent-success" class="alert alert-success alert-dismissable" hidden="true">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button> Success! Profile
            details sent to
          </div>
          <div id="email-sent-failed" class="alert alert-failure alert-dismissable" hidden="true">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button> Failure! Profile
            details not sent to
          </div>
        </form>
            </td>
          </tr>
      </tbody>
    </table>
  </div>
</div>
</div>
   
    <!-- TWITTER -->
    <% if (profile.social.twitter.status) { %>
    <div>
      <h3><i class="fa fa-twitter-square" aria-hidden="true"></i> Recent Tweets</h3>
      <table id="recent-tweets" class="table table-hover table-user-information">
        <thead>
          <tr>
            <th>Tweet</th>
            <th>Date/Time</th>
            <th>Source</th>
            <th>Geo</th>
            <th>Coordinates</th>
            <th>Place</th>
        </thead>
        <tbody>
          <% for(var i=0; i < profile.social.twitter.status.length; i++) { %>
            <% let status = profile.social.twitter.status[i] %>
            <tr data-href="https://twitter.com/<%=profile.social.twitter.handle%>/status/<%=status.id_str%>" class="tr-link">
              <td><%= status.text %></td>
              <td><%= status.createdAd.toLocaleString() %></td>
              <td><%= status.source %></td>
              <td><%= status.geo %></td>
              <td><%= status.coordinates %></td>
              <td><%= status.place.name ? status.place.name + " - " + status.place.country + "(" + status.place.type + ")" : "" %></td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  <% } %>

    <!-- FACEBOOK -->
    <% if (profile.social.facebook.posts) { %>
    <div>
      <h3><i class="fa fa-facebook-square" aria-hidden="true"></i> Recent Posts</h3>
      <table id="recent-fb-posts" class="table table-hover table-user-information">
        <thead>
          <tr>
            <th>Message</th>
            <th>Story</th>
            <th>Date/Time</th>
        </thead>
        <tbody>
          <% for(var i=0; i < profile.social.facebook.posts.length; i++) { %>
            <% let post = profile.social.facebook.posts[i] %>
            <tr data-href="https://facebook.com/<%=profile.social.facebook.profile%>/posts/<%=post.id.split('_')[1]%>" class="tr-link">
              <td><%= post.message %></td>
              <td><%= post.story %></td>
              <td><%= post.created_time.toLocaleString() %></td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  <% } %>

</div>
<script>
  $("#sendBtn").click(function () {
    var id = document.getElementById("profileId").value
    var sendEmail = document.getElementById("sendEmail").value
    /*
    var d = 
    {
      email : sendEmail,
      userid: id
    };
    if (sendEmail != null && sendEmail != "")
    {
      $.ajax({
        type: "POST",
        url: 'http://localhost:3000/api/notify',
        data: d,
        success: function(res) {
            $(".result").html(res);    
        },
        error: function(err) {
            $(".result").html(err); 
        }
      })
      }
    }*/
    var success = true;
    if (success) {
      var div = document.getElementById('email-sent-success');
      div.innerHTML = div.innerHTML + email;
      $("#email-sent-success").show();
    }
    else {
      var div = document.getElementById('email-sent-failed');
      div.innerHTML = div.innerHTML + email;
      $("#email-sent-failed").show();
    }
  });
  $(document).ready(() => {
    $('tr[data-href]').on("click", function () {
      window.open($(this).data('href'), '_blank');
    });
  });
</script>

<% include ../../views/partials/footer %>